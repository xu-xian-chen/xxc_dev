<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>å¾å…ˆç›çš„ä¸ªäººåšå®¢</title>
  <style>
    body {
      font-family: 'Helvetica Neue', sans-serif;
      margin: 0; padding: 0;
      background-color: #f9f9f9;
      color: #333;
    }
    header {
      background-color: #0d47a1;
      color: white;
      padding: 40px 20px;
      text-align: center;
    }
    nav {
      background-color: #eeeeee;
      padding: 10px;
      text-align: center;
    }
    nav a {
      margin: 0 15px;
      text-decoration: none;
      color: #0d47a1;
      font-weight: bold;
    }
    .container {
      max-width: 900px;
      margin: 40px auto;
      padding: 0 20px;
    }
    section {
      background: white;
      padding: 20px 24px;
      margin-bottom: 40px;
      border-radius: 6px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      position: relative;
    }
    .post {
      border-left: 4px solid #0d47a1;
      background: #fff;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      border-radius: 4px;
    }

    /* ç•™è¨€æ¿æ ·å¼ */
    #comment-form input[type="text"],
    #comment-form textarea {
      width: calc(100% - 40px);
      padding: 8px 20px;
      margin-bottom: 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
      resize: vertical;
      box-sizing: border-box;
    }
    #comment-form button {
      background-color: #0d47a1;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }
    #comment-form button:hover {
      background-color: #083d8a;
    }
    .comment {
      border-bottom: 1px solid #ddd;
      padding: 12px 0;
    }
    .comment-reply {
      background: #f0f4ff;
      margin: 8px 0 8px 20px;
      padding: 8px 12px;
      border-radius: 3px;
    }
    .reply-btn {
      background: none;
      border: none;
      color: #0d47a1;
      cursor: pointer;
      font-size: 13px;
      padding: 0;
      margin-top: 4px;
    }
    .reply-btn:hover {
      text-decoration: underline;
    }
    #cancel-reply {
      background-color: #666;
      margin-left: 10px;
    }
    footer {
      background-color: #0d47a1;
      color: white;
      text-align: center;
      padding: 20px;
      margin-top: 40px;
    }
    @media (max-width: 600px) {
      nav a {
        display: block;
        margin: 10px 0;
      }
      #comment-form input[type="text"],
      #comment-form textarea {
        width: calc(100% - 32px);
        padding: 8px 16px;
      }
    }
    .reply-box input[type="text"],
    .reply-box textarea {
      width: calc(100% - 40px);
      padding: 8px 20px;
      margin-bottom: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
      resize: vertical;
      box-sizing: border-box;
      display: block;
    }
  </style>
</head>
<body>
  <header>
    <h1>å¾å…ˆç›çš„ä¸ªäººåšå®¢</h1>
    <p>è®°å½•æˆé•¿ | åˆ†äº«æŠ€æœ¯ | ç•™ä¸‹ç—•è¿¹</p>
  </header>

  <nav>
    <a href="#about">å…³äºæˆ‘</a>
    <a href="#blog">åšå®¢æ–‡ç« </a>
    <a href="#comments">ç•™è¨€æ¿</a>
    <a href="#contact">è”ç³»æˆ‘</a>
  </nav>

  <div class="container">
    <section id="about">
      <h2>ğŸ‘‹ å…³äºæˆ‘</h2>
      <p>ä½ å¥½ï¼Œæˆ‘æ˜¯å¾å…ˆç›ï¼Œä¸€åçƒ­çˆ±ç¼–ç¨‹ä¸æ€è€ƒçš„æŠ€æœ¯ä»ä¸šè€…ã€‚å–œæ¬¢æ¢ç´¢ç³»ç»Ÿæ¶æ„ã€æ•°æ®åˆ†æã€è‡ªåŠ¨åŒ–å·¥å…·ï¼Œä¹Ÿæ—¶å¸¸è®°å½•ç”Ÿæ´»ä¸æ‰€æ„Ÿæ‰€æ‚Ÿã€‚</p>
    </section>

    <section id="blog">
      <h2>ğŸ“ æœ€æ–°æ–‡ç« </h2>
      <div class="post">
        <h3>å¦‚ä½•ç”¨ Python æ„å»ºæ•°æ®åˆ†ææµç¨‹</h3>
        <p>æœ¬æ–‡å°†åˆ†äº«æˆ‘åœ¨å®é™…é¡¹ç›®ä¸­å¦‚ä½•é€šè¿‡ pandas å’Œ matplotlib å¿«é€Ÿæ­å»ºæ•°æ®å¤„ç†ä¸å¯è§†åŒ–æ¡†æ¶ã€‚</p>
        <small>å‘å¸ƒæ—¥æœŸï¼š2025-08-01</small>
      </div>
      <div class="post">
        <h3>æˆ‘çš„ Linux å­¦ä¹ ä¹‹è·¯</h3>
        <p>ä»æœ€åˆçš„å®‰è£…ç³»ç»Ÿã€é…ç½®ç¯å¢ƒï¼Œåˆ°ç†Ÿç»ƒä½¿ç”¨ shellã€ç¼–å†™è„šæœ¬ï¼Œè¿™æ˜¯ä¸€æ®µæŒç»­è¿›æ­¥çš„æ—…ç¨‹ã€‚</p>
        <small>å‘å¸ƒæ—¥æœŸï¼š2025-07-25</small>
      </div>
    </section>

    <section id="comments">
      <h2>ğŸ’¬ ç•™è¨€æ¿</h2>
      <form id="comment-form">
        <input type="hidden" name="parent_id" id="parent_id" value="" />
        <p><input type="text" name="name" placeholder="ä½ çš„åå­—" required /></p>
        <p><textarea name="message" rows="4" placeholder="å†™ä¸‹ä½ çš„ç•™è¨€" required></textarea></p>
        <p>
          <button type="submit">æäº¤ç•™è¨€</button>
          <button type="button" id="cancel-reply" style="display:none;">å–æ¶ˆå›å¤</button>
        </p>
        <div id="feedback"></div>
      </form>

      <div id="comment-list">
        {% set show_limit = 3 %}
        {% for msg in messages %}
          {% if loop.index0 < show_limit %}
            <div class="comment" data-id="{{ msg.id }}">
              <p><strong>{{ msg.name }}</strong> è¯´ï¼š</p>
              <p>{{ msg.message }}</p>
              <p><small>{{ msg.created_at.strftime('%Y-%m-%d %H:%M') }}</small></p>
              <button class="reply-btn" data-id="{{ msg.id }}" data-name="{{ msg.name }}">å›å¤</button>

              <div class="reply-box" id="reply-box-{{ msg.id }}" style="display:none; margin-top:8px;">
                <input type="text" class="reply-name" placeholder="ä½ çš„åå­—" />
                <textarea rows="3" placeholder="å›å¤ {{ msg.name }}"></textarea>
                <button class="send-reply-btn" data-parent-id="{{ msg.id }}">å‘é€å›å¤</button>
                <button class="cancel-reply-btn" data-parent-id="{{ msg.id }}">å–æ¶ˆ</button>
                <div class="reply-feedback"></div>
              </div>

              <div class="replies" style="margin-left:20px; margin-top:10px;">
                {% for reply in messages %}
                  {% if reply.parent_id == msg.id %}
                  <div class="comment-reply" data-id="{{ reply.id }}">
                    <p><strong>{{ reply.name }}</strong> å›å¤ï¼š</p>
                    <p>{{ reply.message }}</p>
                    <p><small>{{ reply.created_at.strftime('%Y-%m-%d %H:%M') }}</small></p>
                    <button class="reply-btn" data-id="{{ reply.id }}" data-name="{{ reply.name }}">å›å¤</button>

                    <div class="reply-box" id="reply-box-{{ reply.id }}" style="display:none; margin-top:8px;">
                      <input type="text" class="reply-name" placeholder="ä½ çš„åå­—" />
                      <textarea rows="3" placeholder="å›å¤ {{ reply.name }}"></textarea>
                      <button class="send-reply-btn" data-parent-id="{{ reply.id }}">å‘é€å›å¤</button>
                      <button class="cancel-reply-btn" data-parent-id="{{ reply.id }}">å–æ¶ˆ</button>
                      <div class="reply-feedback"></div>
                    </div>
                  </div>
                  {% endif %}
                {% endfor %}
              </div>
            </div>
          {% else %}
            {% if loop.index0 == show_limit %}
            <div id="folded-comments" style="display:none;">
            {% endif %}
            <div class="comment" data-id="{{ msg.id }}">
              <p><strong>{{ msg.name }}</strong> è¯´ï¼š</p>
              <p>{{ msg.message }}</p>
              <p><small>{{ msg.created_at.strftime('%Y-%m-%d %H:%M') }}</small></p>
              <button class="reply-btn" data-id="{{ msg.id }}" data-name="{{ msg.name }}">å›å¤</button>

              <div class="reply-box" id="reply-box-{{ msg.id }}" style="display:none; margin-top:8px;">
                <input type="text" class="reply-name" placeholder="ä½ çš„åå­—" />
                <textarea rows="3" placeholder="å›å¤ {{ msg.name }}"></textarea>
                <button class="send-reply-btn" data-parent-id="{{ msg.id }}">å‘é€å›å¤</button>
                <button class="cancel-reply-btn" data-parent-id="{{ msg.id }}">å–æ¶ˆ</button>
                <div class="reply-feedback"></div>
              </div>

              <div class="replies" style="margin-left:20px; margin-top:10px;">
                {% for reply in messages %}
                  {% if reply.parent_id == msg.id %}
                  <div class="comment-reply" data-id="{{ reply.id }}">
                    <p><strong>{{ reply.name }}</strong> å›å¤ï¼š</p>
                    <p>{{ reply.message }}</p>
                    <p><small>{{ reply.created_at.strftime('%Y-%m-%d %H:%M') }}</small></p>
                    <button class="reply-btn" data-id="{{ reply.id }}" data-name="{{ reply.name }}">å›å¤</button>

                    <div class="reply-box" id="reply-box-{{ reply.id }}" style="display:none; margin-top:8px;">
                      <input type="text" class="reply-name" placeholder="ä½ çš„åå­—" />
                      <textarea rows="3" placeholder="å›å¤ {{ reply.name }}"></textarea>
                      <button class="send-reply-btn" data-parent-id="{{ reply.id }}">å‘é€å›å¤</button>
                      <button class="cancel-reply-btn" data-parent-id="{{ reply.id }}">å–æ¶ˆ</button>
                      <div class="reply-feedback"></div>
                    </div>
                  </div>
                  {% endif %}
                {% endfor %}
              </div>
            </div>
            {% if loop.last %}
            </div>
            {% endif %}
          {% endif %}
        {% endfor %}
      </div>

      {% if messages|length > show_limit %}
      <p style="text-align:center; margin-top:-30px;">
        <button id="toggle-fold-btn" style="background:none; border:none; color:#0d47a1; cursor:pointer; font-weight:bold;">
          å±•å¼€æ›´å¤šç•™è¨€ â–¼
        </button>
      </p>
      {% endif %}


    </section>

    <section id="contact">
      <h2>ğŸ“¬ è”ç³»æˆ‘</h2>
      <p>é‚®ç®±ï¼š553169719@qq.com</p>
      <p>GitHubï¼š<a href="https://github.com/xu-xian-chen" target="_blank">xuxianchen</a></p>
    </section>
  </div>

  <footer>
    <p>Â© 2025 å¾å…ˆç› ç‰ˆæƒæ‰€æœ‰</p>
    <p>å¤‡æ¡ˆå·ï¼šè’™ICPå¤‡2025021794å·</p>
  </footer>

  <script>
    // ä¸»ç•™è¨€è¡¨å•æäº¤
    const commentForm = document.getElementById('comment-form');
    const feedback = document.getElementById('feedback');
    const cancelReplyBtn = document.getElementById('cancel-reply');

    commentForm.addEventListener('submit', e => {
      e.preventDefault();
      const name = commentForm.name.value.trim();
      const message = commentForm.message.value.trim();
      const parent_id = commentForm.parent_id.value || null;

      if (!name) {
        feedback.innerHTML = '<span style="color:red;">è¯·è¾“å…¥ä½ çš„åå­—</span>';
        return;
      }
      if (!message) {
        feedback.innerHTML = '<span style="color:red;">è¯·è¾“å…¥ç•™è¨€å†…å®¹</span>';
        return;
      }

      feedback.innerHTML = 'å‘é€ä¸­...';

      fetch('/add_message', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({name, message, parent_id})
      }).then(res => res.json()).then(data => {
        if (data.success) {
          feedback.innerHTML = `<span style="color:green;">${parent_id ? 'å›å¤æˆåŠŸï¼' : 'ç•™è¨€æˆåŠŸï¼'} é¡µé¢å°†åœ¨1ç§’åˆ·æ–°</span>`;
          commentForm.reset();
          commentForm.parent_id.value = '';
          cancelReplyBtn.style.display = 'none';
          setTimeout(() => window.location.reload(), 1000);
        } else {
          feedback.innerHTML = `<span style="color:red;">${data.message}</span>`;
        }
      }).catch(() => {
        feedback.innerHTML = '<span style="color:red;">ç½‘ç»œé”™è¯¯ï¼Œå‘é€å¤±è´¥</span>';
      });
    });

    cancelReplyBtn.addEventListener('click', () => {
      commentForm.parent_id.value = '';
      cancelReplyBtn.style.display = 'none';
    });

    // å›å¤æŒ‰é’®åˆ‡æ¢æ˜¾ç¤ºå¯¹åº”å›å¤æ¡†
    document.querySelectorAll('.reply-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const parentId = btn.getAttribute('data-id');
        const replyBox = document.getElementById('reply-box-' + parentId);
        if (!replyBox) return;

        // å…³é—­å…¶å®ƒå›å¤æ¡†
        document.querySelectorAll('.reply-box').forEach(box => {
          if (box !== replyBox) box.style.display = 'none';
        });

        replyBox.style.display = (replyBox.style.display === 'none' || replyBox.style.display === '') ? 'block' : 'none';
        if (replyBox.style.display === 'block') {
          commentForm.parent_id.value = parentId;
          cancelReplyBtn.style.display = 'inline-block';
          window.scrollTo({top: replyBox.offsetTop - 100, behavior: 'smooth'});
        } else {
          commentForm.parent_id.value = '';
          cancelReplyBtn.style.display = 'none';
        }
      });
    });

    // å–æ¶ˆå›å¤æŒ‰é’®
    document.querySelectorAll('.cancel-reply-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const parentId = btn.getAttribute('data-parent-id');
        const replyBox = document.getElementById('reply-box-' + parentId);
        if (!replyBox) return;
        replyBox.style.display = 'none';
        const nameInput = replyBox.querySelector('.reply-name');
        const textarea = replyBox.querySelector('textarea');
        const replyFeedback = replyBox.querySelector('.reply-feedback');
        if (nameInput) nameInput.value = '';
        if (textarea) textarea.value = '';
        if (replyFeedback) replyFeedback.innerHTML = '';
      });
    });

    // å‘é€å›å¤æŒ‰é’®
    document.querySelectorAll('.send-reply-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const parentId = btn.getAttribute('data-parent-id');
        const replyBox = document.getElementById('reply-box-' + parentId);
        if (!replyBox) return;

        const nameInput = replyBox.querySelector('.reply-name');
        const textarea = replyBox.querySelector('textarea');
        const feedback = replyBox.querySelector('.reply-feedback');

        const name = nameInput.value.trim();
        const message = textarea.value.trim();

        if (!name) {
          feedback.innerHTML = '<span style="color:red;">è¯·è¾“å…¥ä½ çš„åå­—</span>';
          return;
        }
        if (!message) {
          feedback.innerHTML = '<span style="color:red;">è¯·è¾“å…¥å›å¤å†…å®¹</span>';
          return;
        }

        feedback.innerHTML = 'å‘é€ä¸­...';

        fetch('/add_message', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({name, message, parent_id: parentId})
        }).then(res => res.json()).then(data => {
          if (data.success) {
            feedback.innerHTML = '<span style="color:green;">å›å¤æˆåŠŸï¼é¡µé¢å°†åœ¨1ç§’åˆ·æ–°</span>';
            nameInput.value = '';
            textarea.value = '';
            setTimeout(() => window.location.reload(), 1000);
          } else {
            feedback.innerHTML = `<span style="color:red;">${data.message}</span>`;
          }
        }).catch(() => {
          feedback.innerHTML = '<span style="color:red;">ç½‘ç»œé”™è¯¯ï¼Œå‘é€å¤±è´¥</span>';
        });
      });
    });
    const toggleBtn = document.getElementById('toggle-fold-btn');
    const foldedComments = document.getElementById('folded-comments');

    if (toggleBtn && foldedComments) {
      toggleBtn.addEventListener('click', () => {
        if (foldedComments.style.display === 'none') {
          foldedComments.style.display = 'block';
          toggleBtn.textContent = 'æ”¶èµ·ç•™è¨€ â–²';
        } else {
          foldedComments.style.display = 'none';
          toggleBtn.textContent = 'å±•å¼€æ›´å¤šç•™è¨€ â–¼';
        }
      });
    }

  </script>
</body>
</html>
